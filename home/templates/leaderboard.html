{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
{% endblock %}

{% block content %}
<main class="main-content leaderboard-page">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>Leaderboard</h1>
            <p class="page-description">Top performers with the least errors in their essays</p>
        </div>

        <!-- Top 3 Podium -->
        {% if essays %}
        <div class="podium-section">
            <div class="podium">
                {% for essay in essays|slice:":3" %}
                {% if forloop.counter == 1 %}
                <div class="podium-item first">
                    <div class="rank-badge gold"><span>1st</span></div>
                    {% elif forloop.counter == 2 %}
                    <div class="podium-item second">
                        <div class="rank-badge silver"><span>2nd</span></div>
                        {% else %}
                        <div class="podium-item third">
                            <div class="rank-badge bronze"><span>3rd</span></div>
                            {% endif %}

                            <h3>{{ essay.user.username }}</h3>
                            <p class="essay-title">{{ essay.title|truncatewords:5 }}</p>
                            <div class="score-info">
                                <span class="score">{{ essay.score }}</span>
                                <span class="score-label">Score</span>
                            </div>
                            <div class="error-stats">
                                <div class="error-item">
                                    <span class="error-count">{{ essay.grammar_errors }}</span>
                                    <span class="error-type">Grammar</span>
                                </div>
                                <div class="error-item">
                                    <span class="error-count">{{ essay.spelling_errors }}</span>
                                    <span class="error-type">Spelling</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Full Leaderboard Table -->
                <div class="leaderboard-table-section">
                    <h2>All Rankings</h2>
                    {% if essays %}
                    <div class="table-wrapper">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>User</th>
                                    <th>Essay Title</th>
                                    <th>Score</th>
                                    <th>Grammar Errors</th>
                                    <th>Spelling Errors</th>
                                    <th>Total Errors</th>
                                    <th>Submitted On</th>
                                    <th>PDF</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for essay in essays %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ essay.user.username }}</td>
                                    <td>{{ essay.title }}</td>
                                    <td>{{ essay.score }}</td>
                                    <td>{{ essay.grammar_errors }}</td>
                                    <td>{{ essay.spelling_errors }}</td>
                                    <td>{{ essay.total_errors }}</td>
                                    <td>{{ essay.created_at|date:"M d, Y" }}</td>
                                    <td>
                                        {% if essay.pdf_file %}
                                        <a href="{{ essay.pdf_file.url }}" download>Download PDF</a>
                                        {% else %}
                                        N/A
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <h3>No Essays Yet</h3>
                        <p>Be the first to submit an essay and top the leaderboard!</p>
                        <a href="{% url 'submit_essay' %}" class="btn-primary">Submit Essay</a>
                    </div>
                    {% endif %}
                </div>
            </div>
</main>
{% endblock %}