{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/essay.css' %}">
<script src="{% static 'js/essay.js' %}"></script>
{% endblock %}


{% block content %}             
<!-- Main Content -->
<main class="main-content">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>Submit Your Essay</h1>
            <p class="page-description">Write your essay below. Our AI will check for grammar and spelling errors.</p>
        </div>

        <!-- Essay Form -->
        <div class="essay-form-container">
            <form id="essayForm" class="essay-form" method="POST" action="{% url 'submit_essay' %}">
                {% csrf_token %}
                <input type="hidden" id="loggedInUser" value="{{ request.user.username }}">

                <!-- Essay Title -->
                <div class="form-group">
                    <label for="essayTitle">Essay Title <span class="required">*</span></label>
                    <input type="text" id="essayTitle" name="title" placeholder="Enter your essay title" required>
                    <span class="error-message" id="titleError"></span>
                </div>

                <!-- Essay Topic (Optional) -->
                <div class="form-group">
                    <label for="essayTopic">Topic/Category</label>
                    <select id="essayTopic" name="topic">
                        <option value="">Select a topic (optional)</option>
                        <option value="education">Education</option>
                        <option value="technology">Technology</option>
                        <option value="environment">Environment</option>
                        <option value="social">Social Issues</option>
                        <option value="culture">Culture</option>
                        <option value="politics">Politics</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="essayLanguage">Language</label>
                    <select id="essayLanguage" name="topic">
                        <option value="english">English</option>
                        <option value="Nepali">Nepali</option>
                    </select>
                </div>

                <!-- Essay Content -->
                <div class="form-group">
                    <label for="essayContent">Essay Content <span class="required">*</span></label>
                    <div id="paragraphContainer"></div>
                    <!-- SINGLE hidden textarea for Django -->
                    <textarea id="essayContent" name="content" style="display:none;" required></textarea>

                    <button type="button" id="addParagraphBtn" class="btn-secondary" style="margin-top: 10px;">+ Add
                        Paragraph</button>

                    <span class="error-message" id="contentError"></span>

                    <div class="helper-text">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M12 16v-4M12 8h.01" />
                        </svg>
                        <span>Minimum 100 words required. Write clearly and check for errors before submitting.</span>
                    </div>
                </div>

                <!-- Guidelines Box -->
                <div class="guidelines-box">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="16" x2="12" y2="12" />
                            <line x1="12" y1="8" x2="12.01" y2="8" />
                        </svg>
                        Essay Guidelines
                    </h3>
                    <ul>
                        <li>Write at least 100 words</li>
                        <li>Use proper grammar and punctuation</li>
                        <li>Check your spelling before submitting</li>
                        <li>Stay on topic and be original</li>
                        <li>No plagiarism - write in your own words</li>
                    </ul>
                </div>

                <!-- Action Buttons -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="saveDraft">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                        Save as Draft
                    </button>
                    <button type="button" class="btn-preview" id="previewBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                            <circle cx="12" cy="12" r="3" />
                        </svg>
                        Preview
                    </button>
                    <button type="button" class="btn-submit" id="submitBtn">
                        <span class="btn-text">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="22" y1="2" x2="11" y2="13" />
                                <polygon points="22 2 15 22 11 13 2 9 22 2" />
                            </svg>
                            Submit Essay
                        </span>
                        <span class="btn-loader" style="display: none;">
                            <svg class="spinner" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" />
                            </svg>
                            Processing...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</main>

<!-- Preview Modal -->
<div class="modal" id="previewModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Essay Preview</h2>
            <button class="modal-close" id="closeModal">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <h3 id="previewTitle"></h3>
            <div id="previewContent"></div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" id="closePreview">Close</button>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal" id="successModal">
    <div class="modal-content success-content">
        <div class="success-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
        </div>
        <h2>Essay Submitted Successfully!</h2>
        <p>Your essay is being analyzed. You will be redirected to the results page.</p>
        <button class="btn-primary" id="viewResults">View Results</button>
    </div>
</div>

{% endblock %}

{% block extra_js_head %}
<script src="{% static 'js/essay.js' %}"></script>
{% endblock %}